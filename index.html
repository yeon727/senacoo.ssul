<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì„¸ë‚˜ ì¿ í° ìë™ì…ë ¥ê¸° - ë¶ë§ˆí´ë¦¿ ìƒì„±ê¸°</title>
  <style>
    body { font-family: "Noto Sans KR", sans-serif; max-width: 600px; margin: 2rem auto; }
    textarea { width: 100%; font-family: monospace; }
    input, textarea, button { margin: 0.5rem 0; padding: 0.5rem; font-size: 1rem; }
    #bookmarkletCode { height: 100px; }
    .instructions { background: #f0f0f0; padding: 1rem; border-radius: 5px; }
  </style>
</head>
<body>
  <h1>ì„¸ë‚˜ ì¿ í° ìë™ì…ë ¥ê¸° ë¶ë§ˆí´ë¦¿ ìƒì„±ê¸°</h1>

  <label for="memberId">íšŒì›ë²ˆí˜¸ ì…ë ¥</label><br />
  <input type="text" id="memberId" placeholder="íšŒì›ë²ˆí˜¸ ì…ë ¥" />

  <label for="couponList">ì¿ í° ëª©ë¡ (í•œ ì¤„ì— í•œ ê°œì”© ì…ë ¥)</label><br />
  <textarea id="couponList" rows="10" placeholder="ì¿ í°ì½”ë“œë¥¼ ì¤„ë°”ê¿ˆìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”"></textarea>

  <button onclick="generateBookmarklet()">ë¶ë§ˆí´ë¦¿ ìƒì„±</button>

  <h2>ìƒì„±ëœ ë¶ë§ˆí´ë¦¿ ì½”ë“œ</h2>
  <textarea id="bookmarkletCode" readonly></textarea>

  <div class="instructions">
    <h3>ì‚¬ìš©ë²•</h3>
    <ol>
      <li>ìœ„ì˜ í…ìŠ¤íŠ¸ë°•ìŠ¤ì— ìƒì„±ëœ ì½”ë“œë¥¼ ë“œë˜ê·¸í•˜ì—¬ ë¶ë§ˆí¬ë°”ì— ë“œë¡­í•˜ê±°ë‚˜, ë³µì‚¬ í›„ ìƒˆ ë¶ë§ˆí¬ì˜ URLì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”.</li>
      <li>ì¿ í° ì…ë ¥ í˜ì´ì§€ (<a href="https://coupon.netmarble.com/tskgb" target="_blank" rel="noopener noreferrer">https://coupon.netmarble.com/tskgb</a>)ë¥¼ ë°©ë¬¸í•˜ì„¸ìš”.</li>
      <li>ì €ì¥í•œ ë¶ë§ˆí´ë¦¿ ë¶ë§ˆí¬ë¥¼ í´ë¦­í•˜ë©´ ìë™ìœ¼ë¡œ ì¿ í°ì´ ì…ë ¥ë˜ê³  ì‚¬ìš©ë©ë‹ˆë‹¤.</li>
    </ol>
  </div>

<script>
function generateBookmarklet() {
  const memberId = document.getElementById('memberId').value.trim();
  let coupons = document.getElementById('couponList').value
    .split('\n')
    .map(c => c.trim())
    .filter(c => c.length > 0);

  if (!memberId) {
    alert("íšŒì›ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    return;
  }
  if (coupons.length === 0) {
    alert("ì¿ í° ëª©ë¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    return;
  }

  // ìë™ì…ë ¥ ë¶ë§ˆí´ë¦¿ JS í•¨ìˆ˜ (í•œì¤„ë¡œ ì••ì¶•)
  const func = `(async function(){
    const memberId = "${memberId}";
    const coupons = ${JSON.stringify(coupons)};
    let i=0;
    function wait(ms){return new Promise(r=>setTimeout(r,ms));}
    async function step(){
      const modal = document.querySelector("div[role='dialog']");
      if(modal){
        const txt=modal.innerText||"";
        const btns=modal.querySelectorAll("button");
        if(txt.includes("ì¿ í°ì„ ì‚¬ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&btns.length===2){
          btns[1].click();
          console.log("âœ… "+coupons[i-1]+": ì‚¬ìš© í™•ì¸ í´ë¦­");
        }else{
          btns[0].click();
          console.log("âš ï¸ "+coupons[i-1]+": "+txt.split("\\n")[0]);
        }
        await wait(1500);
        return step();
      }
      if(i>=coupons.length){
        console.log("ğŸ‰ ëª¨ë“  ì¿ í° ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
        return;
      }
      const mi=document.querySelector("input[placeholder*='íšŒì›ë²ˆí˜¸']");
      const ci=document.querySelector("input[placeholder*='ì¿ í°ë²ˆí˜¸']");
      const btn=[...document.querySelectorAll("button")].find(b=>b.textContent.includes("ì‚¬ìš©í•˜ê¸°"));
      if(mi&&ci&&btn){
        mi.value=memberId;
        mi.dispatchEvent(new Event('input',{bubbles:true}));
        ci.value=coupons[i];
        ci.dispatchEvent(new Event('input',{bubbles:true}));
        btn.click();
        console.log("ğŸ”„ "+coupons[i]+": ì‚¬ìš© ì‹œë„");
        i++;
      }
      await wait(1500);
      step();
    }
    step();
  })();`;

  // ë¶ë§ˆí´ë¦¿ í˜•ì‹ìœ¼ë¡œ ë§Œë“¤ê¸°
  const bookmarklet = 'javascript:' + encodeURIComponent(func);

  // decodeURIComponentë¡œ ê¹”ë”í•˜ê²Œ ë³´ì´ë„ë¡ ë‹¤ì‹œ ë³€í™˜
  // (ì‚¬ìš©ì ë³µì‚¬ í¸ì˜ë¥¼ ìœ„í•´)
  const prettyCode = 'javascript:' + func.replace(/\s+/g, ' ').trim();

  document.getElementById('bookmarkletCode').value = prettyCode;
}
</script>

</body>
</html>
