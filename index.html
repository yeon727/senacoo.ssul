<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì„¸ë‚˜ ì¿ í° ìë™ì…ë ¥ê¸° - ë¶ë§ˆí´ë¦¿ ìƒì„±ê¸°</title>
  <style>
    body { font-family: "Noto Sans KR", sans-serif; max-width: 600px; margin: 2rem auto; }
    textarea { width: 100%; font-family: monospace; }
    input, textarea, button { margin: 0.5rem 0; padding: 0.5rem; font-size: 1rem; }
    #bookmarkletCode { height: 120px; }
    .instructions { background: #f0f0f0; padding: 1rem; border-radius: 5px; }
  </style>
</head>
<body>
  <h1>ì„¸ë‚˜ ì¿ í° ìë™ì…ë ¥ê¸° ë¶ë§ˆí´ë¦¿ ìƒì„±ê¸°</h1>

  <label for="couponList">ì¿ í° ëª©ë¡ (í•œ ì¤„ì— í•œ ê°œì”© ì…ë ¥)</label><br />
  <textarea id="couponList" rows="10" placeholder="ì¿ í°ì½”ë“œë¥¼ ì¤„ë°”ê¿ˆìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”"></textarea>

  <button onclick="generateBookmarklet()">ë¶ë§ˆí´ë¦¿ ìƒì„±</button>

  <h2>ìƒì„±ëœ ë¶ë§ˆí´ë¦¿ ì½”ë“œ</h2>
  <textarea id="bookmarkletCode" readonly></textarea>

  <div class="instructions">
    <h3>ì‚¬ìš©ë²•</h3>
    <ol>
      <li>ìœ„ í…ìŠ¤íŠ¸ë°•ìŠ¤ì— ìƒì„±ëœ ì½”ë“œë¥¼ ëª¨ë‘ ì„ íƒí•´ì„œ ë³µì‚¬í•˜ì„¸ìš”.</li>
      <li>ë¸Œë¼ìš°ì € ë¶ë§ˆí¬ë°”ì— ìƒˆ ë¶ë§ˆí¬ë¥¼ ë§Œë“¤ê³  URL/ì£¼ì†Œë€ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”.</li>
      <li>ì¿ í° ì…ë ¥ í˜ì´ì§€ (<a href="https://coupon.netmarble.com/tskgb" target="_blank" rel="noopener noreferrer">https://coupon.netmarble.com/tskgb</a>)ì— ì ‘ì†í•œ ë’¤, ë¶ë§ˆí´ë¦¿ ë¶ë§ˆí¬ë¥¼ í´ë¦­í•˜ì„¸ìš”.</li>
    </ol>
  </div>

<script>
function generateBookmarklet() {
  let coupons = document.getElementById('couponList').value
    .split('\n')
    .map(c => c.trim())
    .filter(c => c.length > 0);

  if (coupons.length === 0) {
    alert("ì¿ í° ëª©ë¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    return;
  }

  const func = `(async function(){
    const coupons = ${JSON.stringify(coupons)};
    let i=0;
    function wait(ms){return new Promise(r=>setTimeout(r,ms));}
    async function step(){
      const modals = document.querySelectorAll("div[role='dialog']");
      if(modals.length > 0){
        for(const modal of modals){
          const txt=modal.innerText||"";
          const btns=modal.querySelectorAll("button");
          if(txt.includes("ì•„ì´í…œì´ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤.")){
            const backBtn = [...btns].find(b => b.textContent.includes("ëŒì•„ê°€ê¸°"));
            if(backBtn){
              backBtn.click();
              console.log("ğŸ‰ ì•„ì´í…œ ì§€ê¸‰ ì™„ë£Œ, ëŒì•„ê°€ê¸° í´ë¦­");
              await wait(2000);
            }
          } else if(txt.includes("ì¿ í°ì„ ì‚¬ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&btns.length===2){
            btns[1].click();
            console.log("âœ… "+coupons[i-1]+": ì‚¬ìš© í™•ì¸ í´ë¦­");
            await wait(2000);
          } else if(btns.length > 0){
            btns[0].click();
            console.log("âš ï¸ "+coupons[i-1]+": "+txt.split("\\n")[0]);
            await wait(2000);
          }
        }
        return step();
      }
      if(i>=coupons.length){
        console.log("ğŸ‰ ëª¨ë“  ì¿ í° ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
        return;
      }
      const ci=document.querySelector("input[placeholder*='ì¿ í°ë²ˆí˜¸']");
      const btn=[...document.querySelectorAll("button")].find(b=>b.textContent.includes("ì‚¬ìš©í•˜ê¸°"));
      if(ci&&btn){
        ci.value=coupons[i];
        ci.dispatchEvent(new Event('input',{bubbles:true}));
        btn.click();
        console.log("ğŸ”„ "+coupons[i]+": ì‚¬ìš© ì‹œë„");
        i++;
      }
      await wait(2000);
      return step();
    }
    step();
  })();`;

  const oneLine = func.replace(/\s+/g, ' ').trim();
  const pretty = 'javascript:' + oneLine;
  document.getElementById('bookmarkletCode').value = pretty;
}
</script>

</body>
</html>
