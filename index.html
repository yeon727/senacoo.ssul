<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>세나 쿠폰 자동입력기</title>
</head>
<body>
  <h2>세나 쿠폰 자동입력기</h2>
  <div>
    회원번호:<br>
    <input type="text" id="memberId" placeholder="회원번호 입력" style="width:300px">
  </div>
  <div>
    쿠폰 목록 (한 줄당 하나씩 입력):<br>
    <textarea id="couponList" rows="15" cols="50" placeholder="쿠폰코드 줄바꿈으로 입력"></textarea>
  </div>
  <button onclick="start()">자동입력 시작</button>

  <script>
    function start() {
      const memberId = document.getElementById("memberId").value.trim();
      const coupons = document.getElementById("couponList").value.trim().split('\n').filter(c => c.trim());
      if (!memberId || coupons.length === 0) {
        alert("회원번호와 쿠폰 목록을 모두 입력해주세요.");
        return;
      }
      const code = \`
        (async function(){
          const memberId = "${memberId}";
          const coupons = ${JSON.stringify(coupons)};
          let i = 0;
          function wait(ms){ return new Promise(r=>setTimeout(r, ms)); }
          async function step(){
            const modal = document.querySelector("div[role='dialog']");
            if(modal){
              const txt = modal.innerText||"";
              const btns = modal.querySelectorAll("button");
              if(txt.includes("쿠폰을 사용하시겠습니까?") && btns.length===2){
                btns[1].click();
              } else {
                btns[0].click();
              }
              console.log("모달 처리:", txt);
              await wait(1500);
              return step();
            }
            if(i >= coupons.length){
              console.log("✅ 모두 처리됨");
              return;
            }
            const mi = document.querySelector("input[placeholder*='회원번호']");
            const ci = document.querySelector("input[placeholder*='쿠폰번호']");
            const btn = [...document.querySelectorAll("button")].find(b=>b.textContent.includes("사용하기"));
            if(mi && ci && btn){
              mi.value = memberId; mi.dispatchEvent(new Event('input', {bubbles:true}));
              ci.value = coupons[i]; ci.dispatchEvent(new Event('input', {bubbles:true}));
              btn.click();
              console.log("쿠폰 처리 시도:", coupons[i]);
              i++;
            }
            await wait(1500);
            step();
          }
          step();
        })();
      \`;
      const newTab = window.open("https://coupon.netmarble.com/tskgb","_blank");
      newTab.onload = () => newTab.eval(code);
    }
  </script>
</body>
</html>
