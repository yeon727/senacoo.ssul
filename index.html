<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì„¸ë‚˜ ì¿ í° ìë™ì…ë ¥ê¸° - ë¶ë§ˆí´ë¦¿ ìƒì„±ê¸°</title>
  <style>
    body {
      font-family: "Noto Sans KR", sans-serif;
      max-width: 600px;
      margin: 2rem auto;
      padding: 1rem;
    }
    label {
      font-weight: bold;
      margin-top: 1rem;
      display: block;
    }
    input, textarea, button {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.5rem;
      font-size: 1rem;
      box-sizing: border-box;
    }
    #bookmarkletCode {
      height: 120px;
    }
    .instructions {
      background: #f9f9f9;
      padding: 1rem;
      border-radius: 8px;
      margin-top: 1.5rem;
    }
  </style>
</head>
<body>
  <h1>ì„¸ë‚˜ ì¿ í° ìë™ì…ë ¥ê¸° ë¶ë§ˆí´ë¦¿ ìƒì„±ê¸°</h1>

  <label for="memberId">íšŒì›ë²ˆí˜¸ ì…ë ¥</label>
  <input type="text" id="memberId" placeholder="ì˜ˆ: FFDE4E0127484602B69AF" />

  <label for="couponList">ì¿ í° ëª©ë¡ (í•œ ì¤„ì— í•œ ê°œì”© ì…ë ¥)</label>
  <textarea id="couponList" rows="10" placeholder="ì˜ˆ:\nPROFILE\nGACHAGETCHA\nSENAARENA\n..."></textarea>

  <button onclick="generateBookmarklet()">ë¶ë§ˆí´ë¦¿ ìƒì„±</button>

  <label for="bookmarkletCode">ìƒì„±ëœ ë¶ë§ˆí´ë¦¿ ì½”ë“œ</label>
  <textarea id="bookmarkletCode" readonly></textarea>

  <div class="instructions">
    <h3>ğŸ“Œ ì‚¬ìš© ë°©ë²•</h3>
    <ol>
      <li>ìœ„ ì…ë ¥ì¹¸ì— <strong>íšŒì›ë²ˆí˜¸</strong>ì™€ <strong>ì¿ í° ëª©ë¡</strong>ì„ ì…ë ¥í•˜ì„¸ìš”.</li>
      <li>"ë¶ë§ˆí´ë¦¿ ìƒì„±" ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì•„ë˜ ì½”ë“œê°€ ìƒì„±ë©ë‹ˆë‹¤.</li>
      <li>ìƒì„±ëœ ì½”ë“œë¥¼ <strong>ë¸Œë¼ìš°ì € ë¶ë§ˆí¬ë¡œ ë“±ë¡</strong>í•œ ë’¤,</li>
      <li><a href="https://coupon.netmarble.com/tskgb" target="_blank">ì¿ í° ì…ë ¥ í˜ì´ì§€</a>ì— ì ‘ì†í•´ ë¶ë§ˆí´ë¦¿ì„ ì‹¤í–‰í•˜ì„¸ìš”.</li>
    </ol>
  </div>

  <script>
    function generateBookmarklet() {
      const memberId = document.getElementById('memberId').value.trim();
      const coupons = document.getElementById('couponList').value
        .split('\n')
        .map(c => c.trim())
        .filter(c => c.length > 0);

      if (!memberId) {
        alert("íšŒì›ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }
      if (coupons.length === 0) {
        alert("ì¿ í° ëª©ë¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }

      const func = `(async function(){
        const memberId="${memberId}";
        const coupons=${JSON.stringify(coupons)};
        let i=0;
        function wait(ms){return new Promise(r=>setTimeout(r,ms));}
        async function step(){
          const modal=document.querySelector("div[role='dialog']");
          if(modal){
            const txt=modal.innerText||"";
            const btns=modal.querySelectorAll("button");
            if(txt.includes("ì¿ í°ì„ ì‚¬ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&btns.length===2){
              btns[1].click();
              console.log("âœ… "+coupons[i-1]+": ì‚¬ìš© í™•ì¸ í´ë¦­");
            }else{
              btns[0].click();
              console.log("âš ï¸ "+coupons[i-1]+": "+txt.split("\\n")[0]);
            }
            await wait(1500);
            return step();
          }
          if(i>=coupons.length){
            console.log("ğŸ‰ ëª¨ë“  ì¿ í° ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
            return;
          }
          const mi=document.querySelector("input[placeholder*='íšŒì›ë²ˆí˜¸']");
          const ci=document.querySelector("input[placeholder*='ì¿ í°ë²ˆí˜¸']");
          const btn=[...document.querySelectorAll("button")].find(b=>b.textContent.includes("ì‚¬ìš©í•˜ê¸°"));
          if(mi&&ci&&btn){
            mi.value=memberId;
            mi.dispatchEvent(new Event('input',{bubbles:true}));
            ci.value=coupons[i];
            ci.dispatchEvent(new Event('input',{bubbles:true}));
            btn.click();
            console.log("ğŸ”„ "+coupons[i]+": ì‚¬ìš© ì‹œë„");
            i++;
          }
          await wait(1800); step();
        }
        step();
      })();`;

      const oneLine = func.replace(/\s+/g, ' ').trim();
      const bookmarklet = 'javascript:' + oneLine;

      document.getElementById('bookmarkletCode').value = bookmarklet;
    }
  </script>
</body>
</html>
